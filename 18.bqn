#!/usr/bin/env cbqn

âŸ¨_fixâŸ© â† â€¢Import "lib.bqn"

inp â† {â€¢BQN'âŸ©'Â¨âŒ¾((']'=ğ•©)âŠ¸/)'âŸ¨'Â¨âŒ¾(('['=ğ•©)âŠ¸/)ğ•©}Â¨â€¢FLines "18.txt"

Mag â† {ğ•Š fâ€¿s: +Â´3â€¿2Ã—ğ•ŠÂ¨fâ€¿s;ğ•©}
Expr â† {val ğ•Š path : val{ğ•âŒ¾(ğ•¨âŠ¸âŠ‘)}Â´path}
Dig â† {0=â‰¡ğ•© ? 0; 1+ğ•¨ ğ•Š ğ•¨âŠ‘ğ•©}

PathFind â† {
  PathFind 3â€¿pathâ€¿arr:
  pathâˆ¾âŠ‘/2=â‰ Â¨arr;
  PathFind depthâ€¿pathâ€¿arr:
  âŠ‘âŸ¨âŸ¨âŸ©âŸ©âˆ¾Ëœ(Ã—â‰ Â¨)âŠ¸/0â€¿1{1<â‰¡ğ•© ? PathFind âŸ¨depth+1, pathâˆ¾ğ•¨, ğ•©âŸ©;âŸ¨âŸ©}Â¨arr;
  PathFind arr:
  PathFind âŸ¨0, âŸ¨âŸ©, arrâŸ©
}

Explode â† {
  ğ•Š arr:
  path â† PathFind arr
  lâ€¿r â†  arrâŠ‘Â´âŒ½path
  left â† /path
  right â† /Â¬path
  {
    Ã—â‰ left ?
    left â†© 0âˆ¾Ëœpathâ†‘ËœÂ¯1âŠ‘left
    left âˆ¾â†© 1+/â‹ˆ 1 Dig arrâŠ‘Â´âŒ½left
    f â† {lâŠ¸+} Expr left, arr Fâ†©;
    @
  }
  {
    Ã—â‰ right ?
    right â†© 1âˆ¾Ëœpathâ†‘ËœÂ¯1âŠ‘right
    right âˆ¾â†© /â‹ˆ0 Dig arrâŠ‘Â´âŒ½right
    f â† {râŠ¸+} Expr right, arr Fâ†©;
    @
  }
  f â† 0 Expr path
  F arr
}

Split â† {
  done â† 0
  {
    done ? ğ•©;
    0<â‰¡ğ•© ? ğ•ŠÂ¨ğ•©;
    0=â‰¡ğ•© ? ğ•©â‰¥10 ? done â†© 1, (âŒŠâ‹ˆâŒˆ)ğ•©Ã·2;
    ğ•©
  } ğ•©
}
Exb  â† 4<â‰¡
Spb â† âˆ¨Â´9<âˆ¾âŸ(-âŸœ1â‰¡) 
 
Add â† {{ SplitâŸ((Â¬Exb ğ•©)âŠ¸âˆ§Spb) ExplodeâŸExb ğ•©} â€¢_while_ (Exbâˆ¨Spb) ğ•¨â‹ˆğ•©}
â€¢Show Mag AddËœÂ´âŒ½inp
â€¢Show âŒˆÂ´â¥ŠMagâˆ˜AddâŒœËœinp